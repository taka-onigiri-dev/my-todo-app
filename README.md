# my-todo-app

Windows でも開発できる **React Native (Expo) + TypeScript** の ToDo アプリです。

## 概要

シンプルな ToDo 管理アプリ。タスクをグループごとに整理し、追加・完了・削除ができます。データはローカルに永続化されます。

## できること（機能一覧）

- **グループ管理**: タスクをグループ（セクション）ごとに整理
- **グループ追加・編集・削除**: グループ名と色をカスタマイズ
- **グループ折りたたみ**: ▼/▶ ボタンでグループを折りたたみ/展開
- **グループ並べ替え**: ↑↓ ボタンでグループの順序を変更
- **タスク追加**: 各グループ内の入力欄からタスクを追加
- **完了切り替え**: チェックボックスをタップで完了/未完了を切り替え
- **タスク削除**: × ボタンで削除
- **タスク編集**: タスクをタップしてテキストを変更
- **タスク並べ替え**: グループ内で ↑↓ ボタンで順序を変更
- **未分類セクション**: グループに属さないタスク用の専用セクション
- **データ永続化**: アプリを閉じてもタスクとグループが保持される

## 技術スタック

| 項目 | 技術 | バージョン |
|------|------|-----------|
| フレームワーク | React Native (Expo) | SDK 54 |
| 言語 | TypeScript | ~5.7.0 |
| ルーティング | expo-router | ~4.0.22 |
| 永続化 | AsyncStorage | 2.1.2 |
| ジェスチャー | react-native-gesture-handler | ~2.20.0 |
| アニメーション | react-native-reanimated | ~3.16.0 |
| React | react | 18.3.1 |
| React Native | react-native | 0.77.1 |

## データ構造

### Todo 型

```typescript
interface Todo {
  id: string;              // ユニークID（タイムスタンプ + ランダム文字列）
  text: string;            // タスクのテキスト
  completed: boolean;      // 完了フラグ
  createdAt: number;       // 作成日時（Unix timestamp）
  groupId: string | null;  // グループID（未分類の場合は null）
  order: number;           // グループ内の並べ替え順序
}
```

### Group 型

```typescript
interface Group {
  id: string;        // ユニークID（タイムスタンプ + ランダム文字列）
  name: string;      // グループ名
  color: string;     // 表示色（HEX形式）
  order: number;     // グループの並べ替え順序
  collapsed: boolean; // 折りたたみ状態
  createdAt: number; // 作成日時（Unix timestamp）
}
```

### ストレージ

- **タスク**
  - キー: `@my_todo_app:todos`
  - 形式: JSON 配列 (`Todo[]`)
- **グループ**
  - キー: `@my_todo_app:groups`
  - 形式: JSON 配列 (`Group[]`)
- **保存先**: AsyncStorage（デバイスのローカルストレージ）

## ファイル構成

```
my-todo-app/
├── app/
│   ├── _layout.tsx         # ルートレイアウト（ヘッダースタイル設定）
│   └── index.tsx           # メイン ToDo 画面
├── src/
│   └── storage/
│       └── todoStorage.ts  # AsyncStorage 操作（load/save/create）
├── scripts/                # スクリプト
│   ├── start.bat           # Windows 起動（自動更新 + Expo Go）
│   └── start-web.bat       # Windows 起動（自動更新 + Web）
├── assets/                 # アイコン・スプラッシュ画像
├── CLAUDE.md               # Claude 用ガイドライン
├── README.md               # この設計書
├── package.json            # 依存関係
├── tsconfig.json           # TypeScript 設定
├── babel.config.js         # Babel 設定
└── app.json                # Expo 設定
```

### 各ファイルの責務

| ファイル | 責務 |
|---------|------|
| `app/index.tsx` | UI表示、状態管理（useState）、ユーザー操作ハンドリング |
| `app/_layout.tsx` | 全画面共通のレイアウト、ヘッダースタイル |
| `src/storage/todoStorage.ts` | AsyncStorage への読み書き、Todo/Group オブジェクト生成 |

## 画面仕様

### メイン画面（app/index.tsx）

```
┌─────────────────────────────────────┐
│  ToDo リスト              (ヘッダー) │
├─────────────────────────────────────┤
│ [+ グループ追加]                     │
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │ ▼ 仕事 (2)          [↑][↓][×] │ │  ← グループヘッダー（色付き）
│ ├─────────────────────────────────┤ │
│ │ [タスクを追加...            ][+]│ │  ← グループ内入力
│ │ ☐ 会議の資料作成    [↑][↓][×] │ │
│ │ ☐ メール返信        [↑][↓][×] │ │
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │ ▶ 買い物 (3)        [↑][↓][×] │ │  ← 折りたたみ状態
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │   未分類 (1)                    │ │  ← 未分類セクション
│ ├─────────────────────────────────┤ │
│ │ [タスクを追加...            ][+]│ │
│ │ ☐ その他タスク      [↑][↓][×] │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘

【グループ追加モーダル】
┌─────────────────────────────────────┐
│        グループ追加                  │
│ ┌─────────────────────────────────┐ │
│ │ グループ名                       │ │
│ └─────────────────────────────────┘ │
│ 色を選択: ● ● ● ● ● ● ● ●         │
│            [キャンセル] [追加]      │
└─────────────────────────────────────┘

【グループ編集モーダル】
┌─────────────────────────────────────┐
│        グループを編集                │
│ ┌─────────────────────────────────┐ │
│ │ グループ名                       │ │
│ └─────────────────────────────────┘ │
│ 色を選択: ● ● ● ● ● ● ● ●         │
│            [キャンセル] [保存]      │
└─────────────────────────────────────┘

【タスク編集モーダル】
┌─────────────────────────────────────┐
│        タスクを編集                  │
│ ┌─────────────────────────────────┐ │
│ │ タスク内容                       │ │
│ └─────────────────────────────────┘ │
│            [キャンセル] [保存]      │
└─────────────────────────────────────┘
```

### 操作フロー

1. **グループ追加**
   - 「+ グループ追加」ボタンをタップ
   - グループ名を入力、色を選択
   - 「追加」で新規グループ作成

2. **グループ編集**
   - グループヘッダーのタイトル部分をタップ
   - 名前と色を変更
   - 「保存」で反映

3. **グループ削除**
   - グループヘッダーの × ボタンをタップ
   - 確認ダイアログで「削除」
   - グループ内のタスクは未分類に移動

4. **グループ並べ替え**
   - グループヘッダーの ↑↓ ボタンで順序変更

5. **グループ折りたたみ**
   - ▼/▶ ボタンでグループを折りたたみ/展開

6. **タスク追加**
   - 各グループ内の入力欄にテキスト入力
   - 「+」ボタン or Enter で追加

7. **タスク完了切り替え**
   - チェックボックスをタップ
   - 完了時はテキストに取り消し線

8. **タスク編集**
   - タスクのテキスト部分をタップ
   - 編集モーダルで内容を変更

9. **タスク並べ替え**
   - タスク右側の ↑↓ ボタンでグループ内での順序変更

10. **タスク削除**
    - × ボタンで即削除

## セットアップ手順

### 前提条件

- Node.js (LTS)
- iPhone に Expo Go アプリ（App Store からインストール）

### 手順

```bash
# 1. リポジトリをクローン
git clone <repository-url>
cd my-todo-app

# 2. 依存関係をインストール
npm install --legacy-peer-deps

# 3. 開発サーバー起動
npx expo start
```

### npm スクリプト

| コマンド | 説明 |
|---------|------|
| `npm start` | Expo Go で起動 |
| `npm run web` | Web ブラウザで起動 |
| `npm run tunnel` | トンネルモードで起動（別ネットワーク対応） |
| `npm run typecheck` | TypeScript 型チェック |
| `npm run clean` | キャッシュをクリアして起動 |
| `npm run reinstall` | node_modules を削除して再インストール |

### Windows ワンクリック起動

- `scripts/start.bat` → 自動更新して Expo Go 起動
- `scripts/start-web.bat` → 自動更新して Web 起動

### Expo Go で確認

1. PC と iPhone を同じ Wi-Fi に接続
2. `npm start` または `scripts/start.bat` で QR コード表示
3. iPhone カメラで QR を読み取り

## 既知の問題・注意点

### Expo Go 起動時の警告

```
[runtime not ready]: console.error: Could not access feature flag 'disableEventLoopOnBridgeless'
```

- **原因**: React Native 0.77 + Expo SDK 54 の組み合わせで発生する既知の警告
- **影響**: なし（アプリは正常に動作する）
- **対応**: 無視して OK（開発中のみ表示、本番には影響しない）

### npm install 時の警告

```
npm warn deprecated ...
```

- Expo の依存関係に含まれる古いパッケージによる警告
- 機能に影響なし

### `--legacy-peer-deps` が必要な理由

一部パッケージの peer dependency 競合があるため、インストール時に `--legacy-peer-deps` フラグが必要。

## 今後の拡張案

- [ ] 完了/未完了フィルタ
- [ ] 期限（デッドライン）機能
- [ ] リマインダー通知
- [ ] EAS Build で配布ビルド
- [ ] クラウド同期
- [ ] タスクのグループ間移動
